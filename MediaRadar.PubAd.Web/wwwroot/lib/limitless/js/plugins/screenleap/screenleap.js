function Screenleap(){function e(e){e&&"function"==typeof e.nativeDownloadStarting&&(j=e.nativeDownloadStarting),e&&"function"==typeof e.downloadStarting&&(j=e.downloadStarting),e&&"function"==typeof e.localWebServerStartFailed&&(J=e.localWebServerStartFailed),e&&"function"==typeof e.screenShareStarting&&(Y=e.screenShareStarting),e&&"function"==typeof e.appConnectionFailed&&(z=e.appConnectionFailed),e&&"function"==typeof e.screenShareStartError&&(Q=e.screenShareStartError),e&&"function"==typeof e.appSwitchoverCompleted&&(Z=e.appSwitchoverCompleted)}var n=3e3,t=1e3;this.DISABLE_CUSTOM_PROTOCOL_AUTO_START=-1;var r=navigator.userAgent.toLowerCase();this.COOKIE_APP_INSTALLED="__ai",this.COOKIE_API_APP_INSTALLED="__aa",this.COOKIE_FORCE_NEW_INSTALLATION="__ni",this.COOKIE_DISABLE_FORCE_NEW_INSTALLATION="__df",this.isMac=r.indexOf("mac")>-1,this.isWin=r.indexOf("windows ")>-1,this.isChrome=r.indexOf("chrome")>-1,this.isFirefox=r.indexOf("firefox")>-1,this.isSafari=-1!=r.toLowerCase().indexOf("safari")&&!this.isChrome,this.isMSIE=r.indexOf("msie")>-1||r.indexOf("trident")>-1,this.isMSIE8=navigator.appVersion.indexOf("MSIE 8")>-1,this.isWin32=-1==r.indexOf("win64")&&-1==r.indexOf("wow64"),this.isWin64=!this.isWin32,this.hasDotNetFramework=-1!=r.indexOf(".net");var o=null,s=this.isSafari?r.substring(r.indexOf("version")+8,r.indexOf(" safari")):null,i=this.isSafari?s.split("."):null,a=(this.isSafari&&(i.length>=3&&i[0]>=6&&i[2]>=3||i.length>=2&&i[0]>=6&&i[1]>=1||i.length>=1&&i[0]>=7),this.isMac?parseFloat(r.substring(r.indexOf("mac os x")+9,r.indexOf(")")).replace(/_/g,".").replace(";","").replace(")","")):null),c=r.indexOf("trident")>-1,l=Error;l.prototype.getStackTrace=function(){var e=Array.prototype.slice.call(arguments,0),n=this.lineNumber?"line: "+this.lineNumber:"stack: "+this.stack;console.log.apply(console,e.concat([n]))};var u={};u.log="undefined"!=typeof console&&"undefined"!=typeof console.log.bind?console.log.bind(console):"undefined"!=typeof console&&"undefined"!=typeof console.log?console.log:function(){},this.log=u;var p,d=[],f=null,h=null,g="hpcipbhehomfgjbgnajdhiahhdeeffbg",S="",m=null,v=null,E=null,I=null,w=!1,T=null,y=null,O=null,A=null,C=null,R=null,N=3e3,b=!1,_=!1,x=2e4,P=12e3,D=null,L=null,k=window.location.href&&-1!=window.location.href.indexOf("forceDownload=true"),W=null,B=null,F=null,M=!1,V=null,U="API",q=null,K=null,H="",X="",G="",j=null,$=null,J=null,Y=null,z=null,Q=null,Z=null,ee=function(){u.log("Reset share session"),on(),W=null,B=null,F=null,M=!1,V=null,q=null,K=null,m=null,w=!1,T=null,y=null,O=null,A=null,C=null,N=3e3,R=null,P=12e3,D=null,L=!1,fn(),j=null,$=null,J=null,Y=null,Q=null,z=null,Z=null};this.onScreenShareStart=function(){},this.onPresenterConnect=function(){},this.onScreenShareEnd=function(){alert("Screen share ended.")},this.onViewerConnect=function(){},this.onViewerDisconnect=function(){},this.onPause=function(){},this.onResume=function(){},this.error=function(e,n,t){alert("undefined"==typeof t?"Error during "+e+". "+n:t.status?"Error during "+e+", status code: "+t.status:t.message?"Error during "+e+": "+t.message:"Error during "+e+". "+n)},this.setOptions=function(e){"undefined"!=typeof e&&("undefined"!=typeof e.webServerBaseUrl&&(f=e.webServerBaseUrl),"undefined"!=typeof e.presenterAppType&&(m=e.presenterAppType),"undefined"!=typeof e.macAppVersion&&(v=e.macAppVersion),"undefined"!=typeof e.winAppVersion&&(E=e.winAppVersion),"undefined"!=typeof e.browserMessageUrl&&(q=e.browserMessageUrl),"undefined"!=typeof e.startingWindowTitle&&(h=e.startingWindowTitle),"undefined"!=typeof e.appInstalled&&(_=e.appInstalled),"undefined"!=typeof e.serverEnv&&(S=e.serverEnv,("dev"==S||"stage"==S)&&(this.downloadForCustomProtocol=function(){U="SCREENLEAP",ge(We()+Re({origin:"SCREENLEAP"}))},this.startUsingCustomProtocolHandler=function(e,n,t){dn(e,n,t)})),"undefined"!=typeof e.chromeAppId&&(g=e.chromeAppId),"undefined"!=typeof e.downloadNativeTimeout&&(N=e.downloadNativeTimeout),"undefined"!=typeof e.origin&&(U=e.origin),"undefined"!=typeof e.showScreenShareStartErrorDelay&&(P=e.showScreenShareStartErrorDelay),"undefined"!=typeof e.delayAfterDownloadBeforeCallingCustomProtocolHandler&&(x=e.delayAfterDownloadBeforeCallingCustomProtocolHandler),"undefined"!=typeof e.forceDownload&&(k=e.forceDownload),"undefined"!=typeof e.setHooks&&e.setHooks({copyLink:Je,copyShareCode:Ye,copyInstructions:ze,forceSendEntireImage:Qe}),e.presenterAppType&&"dev"!=S&&"stage"!=S&&(u.log=function(e){d[d.length]=e}))},this.getIsProduction=function(){return""==S},this.getUseCustomProtocol=function(){return this.isMac||this.isWin},this.isActiveXFilteringEnabled=function(){if(screenleap.isMSIE)try{return window.external.msActiveXFilteringEnabled()}catch(e){return!1}return!1},this.isBrowserSupportedForExtension=function(){return this.isChrome},this.isBrowserSupportedForNative=function(){return!(this.isWin&&this.isMSIE&&!c)},this.isOSSupportedForNative=function(){return this.isWin||this.isMac&&(a>10.5||10.2>a)},this.getDefaultPresenterAppType=function(){return screenleap.isMac||screenleap.isWin?"NATIVE":"IN_BROWSER"},this.isAppInstalled=function(){return _||"true"==An("API"==U?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED)},this.requiresUserGestureInitiatedDownload=function(e){return(!e||"NATIVE"==e)&&screenleap.isMSIE8&&screenleap.getUseCustomProtocol()&&!screenleap.isAppInstalled()},this.checkIsExtensionInstalled=function(e,n){if(this.isChrome){var t=new Image;if(t.onload=function(){"function"==typeof e&&e()},t.onerror=function(){"function"==typeof n&&n()},!isMobile)try{t.src="chrome-extension://"+g+"/screenleap_icon_16_16.png"}catch(r){screenleap.error("checkIsExtensionInstalled","Error checking extension installation.",r),"function"==typeof n&&n()}}else this.checkIsExtensionEnabled(e,n)},this.checkIsExtensionEnabled=function(e,n,t,r){t||(t=5),r||(r=1);var o=ae();o&&o.getAttribute("installed")?"function"==typeof e&&e():t>r?setTimeout(function(){screenleap.checkIsExtensionEnabled(e,n,t,r+1)},1e3):"function"==typeof n&&n()},this.installExtension=function(e,n,t){this.isBrowserSupportedForExtension()?this.isChrome?(t||(t=window.location.href),fe((ke()?"":We())+"/install-api-extension?redirectUrl="+t)):"function"==typeof n?n("Unexpected supported browser type."):yn("installExtension","Unexpected supported browser type."):"function"==typeof n?n("The extension is only available in Chrome, Firefox and some versions of Safari."):yn("installExtension","The extension is only available in Chrome, Firefox and some versions of Safari.")},this.getCurrentAppVersion=function(){return I};var ne=function(){return!b&&"true"==An(screenleap.COOKIE_FORCE_NEW_INSTALLATION)&&!An(screenleap.COOKIE_DISABLE_FORCE_NEW_INSTALLATION)};this.forceNewInstallation=function(){""==S&&(On(screenleap.COOKIE_FORCE_NEW_INSTALLATION,!0,365,location.hostname),b=!1)};var te=function(){return null!=T},re=function(e,n){var t=document.getElementById("screenleapPorter");t&&document.body.removeChild(t),t=document.createElement("iframe"),mn=function(){},se=function(n,r){u.log("Send call via porter: "+n),t.contentWindow.postMessage(n.split("|"),e),r&&r()};var r=function(n){if(n.origin===e){var t=n.data,r=t[0],o="object"==typeof t[1]?t[1]:{data:t[1]};if("$porter"===r)return void console.log("Porter: "+o.status);o.type=r,Ve(o)}};window.addEventListener("message",r,!1),t.style.display="none";var o={"+":"-","/":"_"},s=n.presenterParams.replace(/([\+\/])/g,function(e){return o[e]}),i=e+"/v2app/porter?e="+s;n.participantId&&(i+="&p="+n.participantId),t.id="screenleapPorter",t.src=i,document.body.appendChild(t)};this.sendUserMessage=function(e){se("ms|"+e)},this.startSharing=function(n,t,r,o){if(u.log("Starting share with app type "+n),"undefined"!=typeof t.useV2&&t.useV2?re(Be()||"https://"+window.location.host.replace(":9000",":9443"),t):(mn=Ke,se=oe),n&&"DEFAULT"==n?n=this.isMac||this.isWin?"NATIVE":"IN_BROWSER":"EXTENSION"==n&&(n="IN_BROWSER"),!n||!Ue(n))return void yn("startSharing","Invalid presenterAppType: "+n);if(t&&!t.screenShareCode)return void yn("startSharing","Missing mandatory screen share data.");if(t&&t.screenShareCode&&!Ze(t.screenShareCode))return void yn("startSharing","Screen share code is not valid: "+t.screenShareCode);if("NATIVE"==n){if(!($||t.presenterParams&&t.screenShareCode))return void yn("startSharing","Missing required information.");if(!xe())return}else if("IN_BROWSER"==n){if(!t.screenShareCode)return void yn("startSharing","Missing required information.");if(!this.isBrowserSupportedForExtension())return void yn("startSharing","This browser is not supported for the sharing extension.")}ee(),m=n,t&&ie(t),e(r);var s=r?r.redirectUrl:null;o&&this.setOptions(o),"IN_BROWSER"==m?t.startedFromApp?(Ee("startSharing"),pe(),Xe()):this.checkIsExtensionEnabled(function(){qe("share",t),Xe()},function(){"dev"==S?alert("Please install the extension before starting an extension share in dev mode"):screenleap.installExtension(function(){qe("share",t)},function(){yn("startSharing","Unable to install screen sharing extension.")},s)}):"NATIVE"==m&&_e(t)},this.startAppUsingCustomProtocolHandler=function(){return dn(B,F,M),!1},this.downloadAndStartNativeApp=function(){return k=!0,W&&me(W),!1},this.getPresenterAppType=function(){return m},this.getScreenShareCode=function(){return B},this.getViewerUrl=function(){return V},this.isScreenShareStarted=function(){return null!=O},this.isScreenShareStopped=function(){return null==B},this.stopSharing=function(){m?"NATIVE"==m?ue(1,!1):"IN_BROWSER"==m&&(qe("stop"),this.endScreenShare({message:"API_CALL"})):screenleap.error("stopSharing","Invalid share state.")},this.pauseSharing=function(){"IN_BROWSER"==m?yn("pauseSharing","The pause call has not ben implemented for the browser extension."):w?se("pa",null,function(e){yn("pause","Error processing pause request",e)}):je("/pause/"+B,null,function(){se("pa",null,function(e){yn("pause","Error processing pause request",e)})})},this.resumeSharing=function(){"IN_BROWSER"==m?yn("resumeSharing","The resume call has not been implemented for the browser extension."):w?se("rr",null,function(e){yn("resume","Error processing resume request",e)}):je("/resume/"+B,null,function(){se("rr",null,function(e){yn("resume","Error processing resume request",e)})})},this.startRecording=function(e,n){K?"IN_BROWSER"==m?qe("startRecording"):se("rt",e,function(e){n&&n(),yn("startRecording","Error processing start recording request",e)}):screenleap.error("startRecording","Recording has not been enabled for the screen share.",{})},this.pauseRecording=function(e,n){K?se("rs",e,function(e){n&&n(),yn("pauseRecording","Error processing pause recording request",e)}):screenleap.error("pauseRecording","Recording has not been paused for the screen share.",{})},this.resumeRecording=function(e,n){K?se("ru",e,function(e){n&&n(),yn("resumeRecording","Error processing resume recording request",e)}):screenleap.error("resumeRecording","Recording has not been resumed for the screen share.",{})},this.stopRecording=function(e,n){K?"IN_BROWSER"==m?qe("stopRecording"):(se("rp",e,function(e){yn("stopRecording","Error processing stop recording request",e)}),n&&n()):screenleap.error("stopRecording","Recording has not been enabled for the screen share.",{})};var oe,se=oe=function(e,n,t){u.log("Send call via app server: "+e),nn("sendApiCallViaAppServer:"+e,{url:q+"/"+e,type:"GET",success:function(e){"function"==typeof n&&n(e)},error:function(e){"function"==typeof t&&t(e)}})};this.endScreenShare=function(e){if(B){e?this.onScreenShareEnd(e.message):this.onScreenShareEnd(),ee(),Ge(),d=[];var n=document.getElementById("screenleapPorter");n&&document.body.removeChild(n);var t=document.getElementById("screenleapDownloader");t&&document.body.removeChild(t)}},this.downloadNativeApp=function(n,t,r){return ee(),"function"!=typeof n?void yn("downloadNativeApp","You need to pass in onAppDownloadEnd callback function"):void(xe()&&($=n,e(t),r&&this.setOptions(r),Se(),_=!0))},this.startNativeApp=function(n,t){ie(n),e(t),m="NATIVE",de(n)},this.checkIsAuthenticatedToExtension=function(){qe("checkIsAuthenticated")},this.signInToExtension=function(e,n){qe("authenticate",{emailAddress:e,password:n})},this.startNewShare=function(e,n,t,r){n=!1;var o=window.location.hostname;if(-1==o.indexOf(".")||0!=o.substr(o.indexOf(".")+1).indexOf("screenleap.com"))screenleap.error("This is for internal use only");else{m="IN_BROWSER";var s={origin:e,isCaptureEntireScreen:n};t&&(s.userId=t),r&&(s.token=r,s.disableShareInstructions=!0,s.hideViewerUrl=!1),qe("newShare",s),Xe()}},this.startNewBroadcast=function(e,n,t,r,o){var s=window.location.hostname;if(-1==s.indexOf(".")||0!=s.substr(s.indexOf(".")+1).indexOf("screenleap.com"))screenleap.error("This is for internal use only");else{m="IN_BROWSER";var i={origin:e,isCaptureEntireScreen:n};t&&(i.accessCode=t),r&&(i.userId=r),o&&(i.token=o,i.disableShareInstructions=!0,i.hideViewerUrl=!1),qe("newBroadcast",i),Xe()}},this.takeShare=function(e,n,t,r){var o=window.location.hostname;-1==o.indexOf(".")||0!=o.substr(o.indexOf(".")+1).indexOf("screenleap.com")?screenleap.error("This is for internal use only"):(m="IN_BROWSER",qe("share",{origin:e,isCaptureEntireScreen:!1,screenShareCode:n,viewerId:t,ctrlHost:r}),Xe())};var ie=function(e){W=e,B=e.screenShareCode,F=e.participantId,M=e.isRequestingToBePresenter,u.log("Extract data for share "+B),V=e.viewerUrl,U=e.origin,"undefined"!=typeof e.browserMessageUrl&&(q=e.browserMessageUrl),K=e.recordingId},ae=function(){var e=document.getElementById("screenleapDiv");return e||(e=document.createElement("div"),e.id="screenleapDiv",e.setAttribute("style","position:fixed;right:1px;bottom:1px;visibility:hidden;width:1px;height:1px"),document.body.appendChild(e)),e},ce=function(){return document.getElementById("screenleapDiv")},le=function(e,n){m?"IN_BROWSER"==m?yn("statusCheck","This check is not valid for extension shares."):"NATIVE"==m&&nn("checkIsShareActive",{url:De()+"/status"+(B?"/"+B:""),type:"POST",success:function(n,t){Ie(),"function"==typeof e&&e(n,t)},error:function(e){var t=!1;B&&e&&(410==e.status?(t=!0,screenleap.endScreenShare({message:"LOCKED"})):400==e.status&&(t=!0,u.log("checkIsShareActive","Screen share "+B+" is not running."))),!t&&O&&G&&u.log("Local status check failed - but without any informative status, and app server connection is active"),"function"==typeof n?n(e):u.log("checkIsShareActive","Error checking app for status",e)}}):"function"==typeof n&&n()},ue=function(e,n){u.log("Send stop message to native"),w?se(n?"sa":"sp",null,function(e){410!=e.status&&yn("stop","Error processing stop request",e)}):nn("stop",{url:De()+"/stop/"+B,type:"POST",success:function(e){u.log("Send successful stop message: "+e)},error:function(){u.log("Stopping share via app server because failed to do so via local web server"),se(n?"sa":"sp",null,function(e){e&&e.status&&400!=e.status&&403!=e.status&&410!=e.status&&yn("stop","Error processing stop request as backup to local stop",e),screenleap.endScreenShare()})}})},pe=function(e){screenleap.getUseCustomProtocol()&&(On("API"==U?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED,!0,365,location.hostname),_=!0),O||(u.log("Screen share started"),O=(new Date).getTime(),screenleap.onScreenShareStart(e),screenleap.getUseCustomProtocol()&&fn())},de=function(e){u.log("Send start message to presenter app"),Y&&Y(),setTimeout(function(){var n="/start?presenterParams="+e.presenterParams;h&&(n+="&startingWindowTitle="+h),mn((new Date).getTime()),$e(n,ln)},t)},fe=function(e){window.location.href=e},he=function(e,n){var t=document.getElementById(e);t||(t=document.createElement("iframe"),t.id=e,t.style.display="none",document.body.appendChild(t)),t.src=n},ge=function(e){screenleap.isMSIE8||screenleap.isActiveXFilteringEnabled()?window.location.href=e:he("screenleapDownloader",e)},Se=function(e){u.log("Download native app"),j&&j(screenleap.startAppUsingCustomProtocolHandler),N&&!screenleap.isMSIE8?setTimeout(function(){me(e)},N):me(e)},me=function(e){screenleap.isMSIE8&&e&&!k||ge(We()+Re(e)),k=!1,screenleap.isMSIE8&&!e&&$?$():screenleap.getUseCustomProtocol()&&e?w||(ne()?je("/quit",null,function(){se("kl")}):de(e)):ve($)},ve=function(e){w?u.log("No local communication alternative for listening for app start."):$e("/status",function(){Ie(),e&&e()})},Ee=function(e){w||u.log(e+": bypass local communication"),w=!0},Ie=function(){T||u.log("Successfully connected to local web server"),T=(new Date).getTime(),Oe(T),R&&(R=null)},we=function(){return p&&T?(new Date).getTime()-T<2e3:!1},Te=function(){y||u.log("App server communication started"),y=(new Date).getTime(),Oe(y),R&&(R=null)},ye=function(){return y},Oe=function(e){C=e?e:(new Date).getTime()},Ae=function(){return C?((new Date).getTime()-C)/1e3:0},Ce=function(){return R?((new Date).getTime()-R)/1e3:0},Re=function(e){var n=e&&e.origin?e.origin:U;return screenleap.isMac?"/share/mac?browser=true&origin="+n+"&isInitialInstallation="+!screenleap.isAppInstalled()+(e?"&screenShareCode="+e.screenShareCode:""):"/share/win?origin="+n+"&standard="+screenleap.getUseCustomProtocol()+"&isInitialInstallation="+!screenleap.isAppInstalled()+(e?"&screenShareCode="+e.screenShareCode:"")},Ne=function(e){u.log("Download and start native app"),e&&e.alreadyDownloaded||Se(e)},be=function(e){Ne(e)},_e=function(e){u.log("Start native app"),e.startedFromApp?(u.log("Started by Mac app"),Ie(),mn((new Date).getTime()),ln()):ne()?gn(e):screenleap.getUseCustomProtocol()&&!D?Pe(function(){Ie(),de(e)},function(){J&&J(),screenleap.isAppInstalled()?pn(e):gn(e)}):Pe(function(){Ie(),de(e)},function(){J&&J(),be(e)})},xe=function(){return screenleap.isOSSupportedForNative()?screenleap.isBrowserSupportedForNative()?!0:(screenleap.error("startSharing","This browser is not supported for the native sharing app.",{message:"BROWSER_NOT_SUPPORTED_FOR_NATIVE"}),!1):(screenleap.error("startSharing","This OS is not supported for the native sharing app.",{message:"OS_NOT_SUPPORTED_FOR_NATIVE"}),!1)},Pe=function(e,n){u.log("Attempting to start using local web server..."),nn("checkIsNativeAppRunning",{url:De()+"/status",type:"POST",success:e,error:n})},De=function(){if(!o){var e=screenleap.isMac||"https:"==window.location.protocol;o=(e?"https:":"http:")+"//0111001101101100.com:"+(e?"5327":"5322")}return o},Le=function(e,n,t){return("API"==U?"screenshare":"screenleap")+(S&&screenleap.isWin?S:"")+(screenleap.isSafari?"://":":")+e+(n?"?p="+n:"")+(t?"&r=true":"")},ke=function(){return-1!=window.location.host.indexOf("screenleap.com")},We=function(){return f?f:Fe()},Be=function(){return We().replace("http://","https://").replace(":9000",":9443")},Fe=function(){return"API"==U?""==S||"stage"==S?window.location.protocol+"//"+("stage"==S?"stage-api":"api")+".screenleap.com":"":ke()?"":window.location.protocol+"//"+("stage"==S?"stage":"www")+".screenleap.com"},Me=function(e,n){u.log(n+": Process "+e);try{for(var t=JSON.parse(e),r=0;r<t.length;r++)B&&Ve(t[r])}catch(o){}},Ve=function(e){switch(e.type){case"ss":pe(e);break;case"sc":if(!A){pe(e),A=(new Date).getTime(),"undefined"!=typeof e.appVersion&&(I=e.appVersion);var n;"API"!=U&&("NATIVE"==m&&screenleap.isMac&&v&&"undefined"!=typeof e.appVersion&&parseInt(v.replace(/\./g,""))-parseInt(e.appVersion.replace(/\./g,""))>=20?(n="FORCE NEW INSTALLATION: current app version = "+e.appVersion+", latest app version = "+v+", difference = "+(parseInt(a.replace(/\./g,""))-parseInt(e.appVersion.replace(/\./g,""))),u.log(n),In(n),screenleap.forceNewInstallation()):"NATIVE"==m&&screenleap.isWin&&E&&"undefined"!=typeof e.appVersion&&parseInt(E.replace(/\./g,""))-parseInt(e.appVersion.replace(/\./g,""))>=200?(n="FORCE NEW INSTALLATION: current app version = "+e.appVersion+", latest app version = "+E+", difference = "+(parseInt(E.replace(/\./g,""))-parseInt(e.appVersion.replace(/\./g,""))),u.log(n),In(n),screenleap.forceNewInstallation()):(On(screenleap.COOKIE_FORCE_NEW_INSTALLATION,"",-1,location.hostname),On(screenleap.COOKIE_DISABLE_FORCE_NEW_INSTALLATION,"true",30,location.hostname),b=!0)),screenleap.onPresenterConnect(e)}break;case"se":je("/ack-se/"+B),screenleap.endScreenShare(e);break;case"cn":screenleap.onViewerConnect(e.participantId,e.externalId);break;case"dn":screenleap.onViewerDisconnect(e.participantId,e.externalId);break;case"sp":screenleap.onPause();break;case"sr":screenleap.onResume();break;case"sa":if(q){var t=("s"==q.charAt(4)?"https://":"http://")+e.hostname+q.substring(q.indexOf("/",q.indexOf("screenleap.com")));u.log("Switching app servers to "+t),q=t,Z&&Z(t)}break;default:ke()&&"function"==typeof screenleap.processResponse&&screenleap.processResponse(e)}},Ue=function(e){return"IN_BROWSER"==e||"NATIVE"==e};this.sendMessageToExtension=function(e,n){qe(e,n)};var qe=function(e,n){n?n.action=e:n={action:e},n.origin||(n.origin=U);var t=ae();if(t){var r=document.createEvent("CustomEvent");r.initCustomEvent("screenleapTrigger",!0,!0,n),t.dispatchEvent(r)}};this.processWebPageMessage=function(e){return Ve(e),!0};var Ke,He=function(e){var n=e.detail;if(n)switch(n.event){case"screenShareStarted":screenleap.onScreenShareStart(n);break;case"screenShareStartFailed":screenleap.error("startSharing","Unable to start share",{status:n.status});break;case"webPageMessage":screenleap.processWebPageMessage(n);break;case"viewerConnected":screenleap.onViewerConnect(n.participantId,n.externalId);break;case"viewerDisconnected":screenleap.onViewerDisconnect(n.participantId,n.externalId);break;case"screenShareStopped":screenleap.endScreenShare(n);break;case"screenShareEnd":screenleap.onScreenShareEnd();break;default:u.log("unknown message from extension: "+n.event)}},Xe=function(){if("IN_BROWSER"==m){var e=ce();e&&e.addEventListener("screenleapExtensionEvent",He)}},Ge=function(){if("IN_BROWSER"==m){var e=ce();e&&e.removeEventListener("screenleapExtensionEvent",He)}},je=function(e,n,t,r,o){return ne()&&"/quit"!=e?void("function"==typeof t&&t()):void nn("sendMessageToNativeApp",{url:De()+e,type:"POST",params:r,responseType:o,success:function(t,r){"/quit"!=e&&(Ie(),"function"==typeof n&&n(t,r))},error:function(e){"function"==typeof t&&t(e)}})},$e=function(e,n,r){r||(r=0),je(e,n,function(o){B&&(o&&409==o.status?screenleap.endScreenShare({message:"CONFLICT"}):o&&400==o.status?screenleap.endScreenShare({message:"ERROR"}):setTimeout(function(){$e(e,n,++r)},t))})},Je=function(e,n){"IN_BROWSER"==m?(qe("sendMessageFromWebPage",{message:"cl"}),e()):w?se("cl",e,n):je("/copy-link",e,function(){se("cl",e,n)})},Ye=function(e,n){"IN_BROWSER"==m?(qe("sendMessageFromWebPage",{message:"cs"}),e()):w?se("cs",e,n):je("/copy-share-code",e,function(){se("cs",e,n)})},ze=function(e,n,t){"IN_BROWSER"==m?(qe("sendMessageFromWebPage",{message:"cc|"+e}),n()):w?se("cc|"+e,n,t):je("/copy-instructions/"+e,n,function(){se("cc|"+e,n,t)})},Qe=function(e,n){w?se("wd",e,n):je("/force-send",e,function(){se("wd",e,n)})},Ze=function(e){return e?(e=""+e,e=e.replace(/ /g,""),e&&9==e.length&&/^[0-9]+$/.test(e)):!1},en=function(){return"withCredentials"in new XMLHttpRequest},nn=function(e,t){var r;if(t.params){t.url+="?";for(var o in t.params)t.url+=o+"="+encodeURIComponent(t.params[o])+"&";t.url=t.url.slice(0,t.url.length-1)}if(t.type||(t.type="GET"),"GET"==t.type&&(t.url+=(-1==t.url.indexOf("?")?"?ts=":"&ts=")+(new Date).getTime()),en())try{if(r=new XMLHttpRequest,r.open(t.type,t.url,!0),r.timeout=t.timeout?t.timeout:n,t.responseType&&(r.responseType=t.responseType),t.data&&r.setRequestHeader("Content-type",t.contentType||"application/x-www-form-urlencoded"),t.headers)for(var s in t.headers)r.setRequestHeader(s,t.headers[s]);r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t.success&&t.success(r.responseType?null:r.responseText,r):t.error&&t.error(r),r=null)},r.send(t.data?t.data:null)}catch(i){t.error&&t.error()}else if("undefined"!=typeof XDomainRequest)try{t.url+=(-1==t.url.indexOf("?")?"?":"&")+"returnOkWithStatus=true",r=new XDomainRequest,r.open(t.type,t.url),r.onload=function(){if(r.responseText){var n;try{n=JSON.parse(r.responseText)}catch(o){u.log(e+": failed to parse response "+r.responseText)}if(n&&n.status&&200!=n.status)return t.error&&t.error({status:n.status,reason:n.reason}),void(r=null)}t.success&&t.success(r.responseText),r=null},r.onerror=function(){t.error&&t.error(),r=null},r.ontimeout=function(){t.error&&t.error(),r=null},r.onprogress=function(){},r.timeout=t.timeout?t.timeout:n,setTimeout(function(){r.send(t.data)},0)}catch(i){t.error&&t.error()}},tn=function(e,n,t){H?H==e?X!=n&&yn(e,"This action is already running. Try reloading the page for a fresh state."):yn(e,"Unable to run this action at the same time as "+H):(H=e,X=n,p=t?t:!1,u.log("Started poll "+X+":"+H))},rn=function(e){e&&H!=e&&X!=e?(X||H)&&u.log(e+": Ignoring request to end poll because current poll is "+X+":"+H):(u.log("Stopped poll"+(X?" "+X+":"+H:"")),H="",X="")},on=function(){rn(),p=!1,G=""},sn=function(e){return p&&w&&(rn(e),u.log("Bypassing local communication - turn off poll "+H)),X==e},an=function(){if("IN_BROWSER"==m)return void u.log("ERROR: _waitForShareShareStart should not be called for extensions");if(u.log("Start polling for share start"),R||(R=(new Date).getTime()),mn((new Date).getTime()),!w&&!O){var e=(new Date).getTime();tn("waitForShareStart",e,!0),cn(e)}},cn=function(e){sn(e)&&le(function(n){rn(e),n&&Me(n,"_pollForShareStartByLocalCommunication"),B&&(u.log("Poll for share start successful"),mn((new Date).getTime()),ln())},function(n){setTimeout(function(){n&&400==n.status?rn(e):cn(e)},1e3)})},ln=function(){pe(),u.log("Start polling for share end"),w||(rn("waitForShareStart"),tn("waitForShareEnd",B,!0),un(B))},un=function(e){sn(e)?le(function(n){var t=!1;Ie(),n&&(u.log("Received message: "+n),t=Me(n,"_pollForShareEndByLocalCommunication")),!t&&B?setTimeout(function(){un(e)},1e3):(u.log("Share ended; stop polling"),rn(e))},function(n){!n||404!=n.status&&400!=n.status?Ae()>30?(u.log("Lost local connection over 30s ago; switch to app server polling."),rn(e),Ee("_pollForShareEndByLocalCommunication")):w?u.log("Ignoring failed local poll because bypass is active."):(u.log("Lost local connection"),setTimeout(function(){un(e)},1e3)):(rn(e),screenleap.endScreenShare())}):u.log("Stop polling local webserver for share end; poll cancelled")},pn=function(e){u.log("using custom protocol handler"),D=(new Date).getTime(),hn(e,!0)},dn=function(e,n,t){var r=Le(e,n,t);u.log("Attempting to start app using custom protocol handler..."),Y&&Y(),screenleap.isMSIE8?setTimeout(function(){window.location.assign(r)},500):screenleap.isChrome?window.location.assign(r):(fn(),he("screenleapCustomProtocol",r))},fn=function(){return document.getElementById("screenleapCustomProtocol")?(document.body.removeChild(document.getElementById("screenleapCustomProtocol")),!0):!1},hn=function(e,n){u.log("pollForCustomProtocolHandlerStart"),an(),screenleap.isScreenShareStarted()||screenleap.isScreenShareStopped()||(k?gn(e):!screenleap.isAppInstalled()&&n?gn(e):(dn(e.screenShareCode,e.participantId,e.isRequestingToBePresenter),setTimeout(function(){!O&&Q&&Q()},P)))},gn=function(e){Ne(e),x!=screenleap.DISABLE_CUSTOM_PROTOCOL_AUTO_START&&setTimeout(function(){hn(e,!1)},x)},Sn=function(){return O?(new Date).getTime()-O:0},mn=Ke=function(e,n){B&&(w||!we()?G&&G!=e||(G||(G=e,u.log("Start polling app server: "+G)),vn(function(n){Te(),we()||Me(n,"_pollAppServerForMessages"),te()||Sn()>500&&Ee("_pollAppServerForMessages"),setTimeout(function(){mn(e)},1e3)},function(t){t&&"400"==t.status?setTimeout(function(){mn(e)},1e3):t&&"404"==t.status?setTimeout(function(){mn(e)},1e3):t&&"410"==t.status?(G="",u.log("Stop polling app server; share ended"),screenleap.endScreenShare({message:"LOCKED"})):n?Ae()>480?(u.log("Connection lost. Ending."),In("ENDING SHARE DUE TO LOST CONNECTION"),screenleap.endScreenShare({message:"LOST_CONNECTION"})):(Ce()>30&&"function"==typeof z&&z(),setTimeout(function(){mn(e,n)},1e3)):Ae()>300?setTimeout(function(){mn(e,!0)},1e3):setTimeout(function(){mn(e)},1e3)},n)):setTimeout(function(){mn(e)},1e3))},vn=function(e,n,t){nn("makeAppServerRequest",{url:q+(C&&O&&!t?"":"?isStart=true"),type:"GET",timeout:6e4,success:function(n){"function"==typeof e&&e(n)},error:function(e){"function"==typeof n&&n(e)}})},En=function(){var e="",n=d;d=[];for(var t=0;t<n.length;t++)e+=n[t]+"\n";return e},In=function(e){var n=wn();n.error=e,nn("emailErrorReport",{url:Fe()+"/screen-share/log-js-email",params:n,data:En(),type:"POST"})},wn=function(){return{userAgent:r,presenterAppType:m,localCommunicationActive:we(),appServerPollingStarted:ye(),localShareStartTime:O,presenterConnectTime:A,lastAppMessageTimestamp:C,screenShareCode:B,participantId:F,isRequestingToBePresenter:M,serverEnv:S,pollingAction:H,appServerPollId:G,isMac:screenleap.isMac,isWin:screenleap.isWin}},Tn=[],yn=function(e,n,t){for(var r=e+n,o=!1,s=0;s<Tn.length;s++)if(Tn[s]==r){o=!0;break}o||(In(e+": "+n+(t&&t.message?" - "+t.message:"")+(t&&t.status?"; status code "+t.status:"")),Tn.push(r)),screenleap.error(e,n,t)},On=function(e,n,t,r){var o="";if(-1==t)o="expires=Thu, 01 Jan 1970 00:00:01 GMT";else if(t){var s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3),o="expires="+s.toUTCString()}document.cookie=e+"="+n+(o?"; "+o:"")+(r?"; domain="+r+"; path=/":"")},An=function(e){for(var n=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){for(var o=t[r];" "==o.charAt(0);)o=o.substring(1);if(-1!=o.indexOf(n))return o.substring(n.length,o.length)}return""}}function screenleapShareCodeFieldKeyUp(e,n){if("undefined"!=typeof isAndroid&&isAndroid)return!0;e=e?e:window.event;var t=window.event?e.keyCode:e.which;if(!e.ctrlKey&&!e.altKey&&!e.shiftKey&&t>=33&&40>=t)return!0;if(n.value.length>0){var r=/^[0-9 ]+$/.test(n.value);if(8==e.keyCode){for(;n.value.length>0&&" "==n.value.charAt(n.value.length-1);)n.value=n.value.substring(0,n.value.length-1);return!0}if(13==e.keyCode&&(screenleapShareCodeFieldAllowHandle&&!r||13==n.value.length))return!0;n.value=formatScreenleapShareCode(n.value)}return!1}function formatScreenleapShareCode(e,n){var t=[],r=0;n||(n=getScreenleapShareCodeSeparator(e)),screenleapShareCodeFieldAllowHandle||(e=e.replace(/\D/g,""));var o=/^[0-9 ]+$/.test(e);if(o){for(var s=0;s<e.length;s++)if(" "!=e.charAt(s))if(t.push(e.charAt(s)),r++,r>0&&9>r&&r%3==0)t.push(n);else if(9==r)break;var i=t.join("");if(e!=i)return i}return e}function getScreenleapShareCodeSeparator(e){for(var n="",t=!1,r=0;r<e.length;r++)if(" "==e.charAt(r))t=!0,n+=" ";else if(t)return n;return""==n?"  ":n}var screenleap=screenleap||new Screenleap,screenleapShareCodeFieldAllowHandle=!0;
//# sourceMappingURL=screenleap.min.js.map